<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Garden</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
   <div class="container mt-4">
    <h1>Digital Garden</h1>
    <p>Explore shared posts and interact with them!</p>
    
  <div id="garden-posts" class="row">
    <!-- 게시글 목록이 동적으로 생성됩니다 -->
    <!-- 이 부분은 jQuery로 처리됩니다 -->
  </div>

    <script>
        $(document).ready(function () {
            // 게시글 목록 가져오기
            $.ajax({
                type: "GET",
                url: "/garden/posts", // 서버에서 게시글 목록을 가져옵니다
                success: function (posts) {
                    const postContainer = $("#garden-posts");
                    postContainer.empty(); // 기존 게시글 제거

                    // 게시글 목록을 동적으로 생성
                    posts.forEach(post => {
                        const likedClass = post.likedByUser ? "btn-danger" : "btn-outline-danger";

                        const postHtml = `
                            <div class="col-md-4 mb-4">
                                <div class="card">
                                    <a href="/garden/${post.id}">
                                        <img src="${post.thumbnail}" class="card-img-top" alt="${post.title}">
                                    </a>
                                    <div class="card-body">
                                        <h5 class="card-title">${post.title}</h5>
                                        <p class="card-text">${post.content}</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <button class="btn ${likedClass} like-button" data-post-id="${post.id}">
                                                <i class="fa fa-heart"></i> Like
                                            </button>
                                            <span class="like-count">${post.likeCount} Likes</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        postContainer.append(postHtml);
                    });

                    // 좋아요 버튼 클릭 이벤트 처리
                    $(".like-button").click(function () {
                        const button = $(this);
                        const postId = button.data("post-id");
                        const action = button.hasClass("btn-danger") ? "unlike" : "like";

                        $.ajax({
                            type: "POST",
                            url: `/garden/${postId}/${action}`,
                            success: function () {
                                const likeCountSpan = button.siblings(".like-count");
                                let likeCount = parseInt(likeCountSpan.text());
                                
                                if (action === "like") {
                                    button.removeClass("btn-outline-danger").addClass("btn-danger");
                                    likeCount++;
                                } else {
                                    button.removeClass("btn-danger").addClass("btn-outline-danger");
                                    likeCount--;
                                }
                                likeCountSpan.text(`${likeCount} Likes`);
                            },
                            error: function () {
                                alert("An error occurred while processing the request.");
                            }
                        });
                    });
                },
                error: function () {
                    alert("Failed to load posts. Please try again later.");
                }
            });
        });
    </script>
</body>
</html>
