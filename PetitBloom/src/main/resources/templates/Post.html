<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Post</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

</head>
<body>
	<h1>Create a New Post</h1>

	<!-- 게시글 작성 폼 -->
	<form id="postForm">
		<label for="title">Title:</label> <input type="text" id="title"
			name="title" required><br>
		<br> <label for="content">Content:</label>
		<textarea id="content" name="content" required></textarea>
		<br>
		<br> <label for="imageUrl">Image URL (optional):</label> <input
			type="text" id="imageUrl" name="imageUrl"><br>
		<br>

		<button type="submit">Post</button>
	</form>

	<div id="errorMessage" style="color: red;"></div>

	<a href="/profile"><button>Back to Profile</button></a>

	<script>
		$(document).ready(function() {
			$("#postForm").submit(function(event) {
				event.preventDefault(); // 폼 제출 기본 동작 방지

				var formData = {
					title : $("#title").val(),
					content : $("#content").val(),
					imageUrl : $("#imageUrl").val()
				};

				$.ajax({
				    type: "POST",
				    url: "/posts", // 서버로 데이터 전송
				    data: formData, // 폼 데이터 전송
				    success: function(response) {
				        if (response.status === "success") {
				            alert("Post created successfully!");
				            window.location.href = response.redirect; // 서버가 반환한 URL로 리다이렉트
				        } else {
				            alert("Error: " + response.message);
				            if (response.redirect) {
				                window.location.href = response.redirect; // 로그인 필요 시 리다이렉트
				            }
				        }
				    },
				    error: function(xhr, status, error) {
				        $("#errorMessage").text("Error: " + xhr.responseText); // 에러 처리
				    }
				});

			});
		});
	</script>

</body>
</html>
