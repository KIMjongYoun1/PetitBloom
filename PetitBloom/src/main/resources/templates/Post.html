<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Post</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-t0VpNGSkFLH+3fGoPjtg7aw7cjo/dmSTi77p0JCQyH0J1oCL+WPN22H34GRJvPWG" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<style>
/* General styles */
:root {
	--primary-color: #6A5ACD; /* 보라색 (배너 색상) */
	--secondary-color: #FFFFFF; /* 흰색 (텍스트, 버튼 배경) */
	--text-color: #333333; /* 텍스트 색상 */
	--background-color: #F9F9F9; /* 페이지 배경색 */
}

body {
	font-family: Arial, sans-serif;
	margin: 0;
	padding: 0;
	background-color: var(--background-color);
	color: var(--text-color);
}

header {
	background-color: var(--primary-color); /* 배너 배경색 보라색 */
	color: var(--secondary-color);
	padding: 2rem;
	text-align: center;
}

header h1 {
	font-size: 3rem;
	margin: 0;
}

header p {
	font-size: 1.2rem;
	margin-top: 0.5rem;
}

main {
	padding: 2rem;
}

.section {
	margin-bottom: 3rem;
}

.cards {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
	gap: 20px;
}

.card {
	background: var(--secondary-color);
	border-radius: 10px;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	overflow: hidden;
}

.card img {
	width: 100%;
	height: 200px;
	object-fit: cover;
}

.card-content {
	padding: 1rem;
}

button {
	background-color: var(--primary-color);
	color: var(--secondary-color);
	border: none;
	padding: 0.8rem 1.5rem;
	font-size: 1rem;
	cursor: pointer;
	border-radius: 5px;
}

button:hover {
	background-color: #5A4DBA; /* hover 시 더 어두운 보라색 */
}

footer {
	text-align: center;
	padding: 1rem;
	background-color: var(--primary-color);
	color: var(--secondary-color);
}
</style>
</head>
<body>

	<Header>New Content</Header>

	<h1>Create a New Post</h1>

	<!-- 게시글 작성 폼 -->
	<form id="postForm" enctype="multipart/form-data">
		<label for="title">Title:</label> 
		<input type="text" id="title" name="title" required><br><br>
		
		<label for="content">Content:</label>
		<textarea id="content" name="content" required></textarea><br><br>
		
		<label for="image">Image (optional):</label> 
		<input type="file" id="image" name="image" accept="image/*"><br><br>

		<!-- 파일 미리보기 -->
		<div id="preview" style="display: none;">
			<h3>Image Preview:</h3>
			<img id="previewImage" src="" alt="Preview" style="max-width: 200px; max-height: 200px;">
		</div>

		<button type="submit">Post</button>
	</form>

	<div id="errorMessage" style="color: red;"></div>

	<a href="/profile"><button>Back to Profile</button></a>

	<div id="postList">
		<!-- 게시글 목록이 동적으로 생성될 곳 -->
		<div class="post-item">
			<img src="/path/to/thumbnail.jpg" alt="Post Thumbnail" style="width: 150px; height: 150px;">
			<!-- 좋아요 갯수만 표시 -->
			<span class="like-count">0 Likes</span>
		</div>
	</div>

	<script>
		$(document).ready(function() {
			$("#postForm").submit(function(event) {
				event.preventDefault(); // 폼 제출 기본 동작 방지

				// FormData 객체 생성
				var formData = new FormData();
				formData.append("title", $("#title").val());
				formData.append("content", $("#content").val());
				formData.append("image", $("#image")[0].files[0]); // 파일 데이터 추가

				$.ajax({
					type: "POST",
					url: "/post", // 서버로 데이터 전송
					data: formData, // 폼 데이터 전송
					processData: false, // FormData는 기본적으로 처리하지 않음
					contentType: false, // 콘텐츠 타입 설정하지 않음
					success: function(response) {
						if (response.status === "success") {
							alert("Post created successfully!");
							window.location.href = response.redirect; // 서버가 반환한 URL로 리다이렉트
						} else {
							alert("Error: " + response.message);
							if (response.redirect) {
								window.location.href = response.redirect; // 로그인 필요 시 리다이렉트
							}
						}
					},
					error: function(xhr, status, error) {
						$("#errorMessage").text("Error: " + xhr.responseText); // 에러 처리
					}
				});
			});

			// 파일 입력 필드의 변경 이벤트 처리 (실시간 미리보기)
			$("#image").on("change", function(event) {
				const file = event.target.files[0];

				if (file) {
					// MIME 타입 검사
					if (file.type.startsWith("image/")) {
						const reader = new FileReader();
						reader.onload = function(e) {
							// 미리보기 이미지 설정
							$("#previewImage").attr("src", e.target.result);
							$("#preview").show(); // 미리보기 표시
						};
						reader.readAsDataURL(file); // 파일을 Data URL로 읽기
					} else {
						alert("Please upload a valid image file.");
						event.target.value = ""; // 잘못된 파일은 초기화
						$("#preview").hide(); // 미리보기 숨기기
					}
				}
			});
		});
	</script>
	
	<footer>
		<p>© 2024 PetitBloom. All Rights Reserved.</p>
	</footer>
</body>
</html>
